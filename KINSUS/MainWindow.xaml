<Window
    x:Class="KINSUS.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:KINSUS"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="KINSUS 雙角色控制台"
    Width="950"
    Height="650"
    Loaded="Window_Loaded"
    mc:Ignorable="d">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <!--  系統模式選擇區  -->
        <GroupBox
            Grid.Row="0"
            Margin="0,0,0,10"
            Padding="10"
            Header="系統模式設定">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock
                    Grid.Column="0"
                    Margin="0,0,10,0"
                    VerticalAlignment="Center"
                    Text="選擇操作模式:" />
                <ComboBox
                    x:Name="cmbMode"
                    Grid.Column="1"
                    Width="150"
                    Margin="0,0,10,0"
                    SelectedIndex="0"
                    SelectionChanged="cmbMode_SelectionChanged">
                    <ComboBoxItem Content="雙向模式 (伺服+用戶端)" />
                    <ComboBoxItem Content="伺服端模式 (僅接收)" />
                    <ComboBoxItem Content="用戶端模式 (僅發送)" />
                </ComboBox>
                <Button
                    x:Name="btnApiGuide"
                    Grid.Column="3"
                    Width="100"
                    Margin="0,0,10,0"
                    Click="btnApiGuide_Click"
                    Content="API 測試指南" />
                <Button
                    x:Name="btnFlowChart"
                    Grid.Column="4"
                    Width="80"
                    HorizontalAlignment="Right"
                    Click="btnFlowChart_Click"
                    Content="流程圖" />
            </Grid>
        </GroupBox>        
        <!--  伺服端角色控制區  -->
        <GroupBox
            x:Name="grpServerControl"
            Grid.Row="1"
            Margin="0,0,0,10"
            Padding="10"
            Header="伺服端角色控制 (接收 IoT 指令)">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock
                    Grid.Row="0"
                    Grid.Column="0"
                    Margin="0,0,10,0"
                    VerticalAlignment="Center"
                    Text="接收位址:" />
                <TextBox
                    x:Name="txtServerUrl"
                    Grid.Row="0"
                    Grid.Column="1"
                    VerticalAlignment="Center"
                    Text="http://localhost:8085/" />
                <Button
                    x:Name="btnConnect"
                    Grid.Row="0"
                    Grid.Column="2"
                    Width="80"
                    Margin="10,0"
                    Click="btnConnect_Click"
                    Content="啟動伺服器" />
                <Button
                    x:Name="btnDisconnect"
                    Grid.Row="0"
                    Grid.Column="3"
                    Width="80"
                    Margin="0,0,10,0"
                    Click="btnDisconnect_Click"
                    Content="停止伺服器"
                    IsEnabled="False" />
                <Rectangle
                    x:Name="rectStatus"
                    Grid.Row="0"
                    Grid.Column="4"
                    Width="20"
                    Height="20"
                    Fill="Gray"
                    Stroke="Black"
                    StrokeThickness="1" />

                <TextBlock
                    Grid.Row="1"
                    Grid.Column="0"
                    Margin="0,10,10,0"
                    VerticalAlignment="Center"
                    Text="伺服器功能:" />
                <StackPanel
                    Grid.Row="1"
                    Grid.Column="1"
                    Grid.ColumnSpan="4"
                    Margin="0,10,0,0"
                    Orientation="Horizontal">                    <ComboBox
                        x:Name="cmbServerResponse"
                        Width="200"
                        Margin="0,0,10,0">
                        <ComboBoxItem Content="成功回應 (200 OK)" />
                        <ComboBoxItem Content="錯誤回應 (400 Bad Request)" />
                        <ComboBoxItem Content="伺服器錯誤 (500 Internal Error)" />
                        <ComboBoxItem Content="自訂回應" />
                    </ComboBox>
                    <Button
                        x:Name="btnSendResponse"
                        Width="80"
                        Margin="0,0,10,0"
                        Click="btnSendResponse_Click"
                        Content="發送回應" />
                    <Button
                        x:Name="btnBroadcast"
                        Width="80"
                        Margin="0,0,10,0"
                        Click="btnBroadcast_Click"
                        Content="廣播訊息" />
                    <Button
                        x:Name="btnKickClient"
                        Width="80"
                        Click="btnKickClient_Click"
                        Content="踢除用戶端"
                        IsEnabled="False" />
                </StackPanel>
            </Grid>
        </GroupBox>

        <!--  用戶端角色控制區  -->
        <GroupBox
            x:Name="grpClientControl"
            Grid.Row="2"
            Margin="0,0,0,10"
            Padding="10"
            Header="用戶端角色控制 (發送至 IoT 系統)">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>                
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock
                    Grid.Row="0"
                    Grid.Column="0"
                    Margin="0,0,10,0"
                    VerticalAlignment="Center"
                    Text="IoT 端點:" />
                <TextBox
                    x:Name="txtIotEndpoint"
                    Grid.Row="0"
                    Grid.Column="1"
                    VerticalAlignment="Center" />
                <TextBlock
                    Grid.Row="0"
                    Grid.Column="2"
                    Margin="10,0"
                    VerticalAlignment="Center"
                    Text="設備編碼:" />
                <TextBox
                    x:Name="txtDevCode"
                    Grid.Row="0"
                    Grid.Column="3"
                    Width="120"
                    VerticalAlignment="Center"
                    Text="DEVICE001" />
                <Button
                    x:Name="btnConnectIoT"
                    Grid.Row="0"
                    Grid.Column="4"
                    Width="80"
                    Margin="10,0"
                    Click="btnConnectIoT_Click"
                    Content="連接 IoT" />
                <Button
                    x:Name="btnDisconnectIoT"
                    Grid.Row="0"
                    Grid.Column="5"
                    Width="80"
                    Margin="0,0,10,0"
                    Click="btnDisconnectIoT_Click"
                    Content="斷開連接"
                    IsEnabled="False" />
                <Rectangle
                    x:Name="rectIoTStatus"
                    Grid.Row="0"
                    Grid.Column="6"
                    Width="20"
                    Height="20"
                    Fill="Gray"
                    Stroke="Black"
                    StrokeThickness="1" />

                <TextBlock
                    Grid.Row="1"
                    Grid.Column="0"
                    Margin="0,10,10,0"
                    VerticalAlignment="Center"
                    Text="API 功能:" />
                <StackPanel
                    Grid.Row="1"
                    Grid.Column="1"
                    Grid.ColumnSpan="3"
                    Margin="0,10,0,0"
                    Orientation="Horizontal">                      <ComboBox
                        x:Name="cmbApiFunction"
                        Width="280"
                        Margin="0,0,10,0"
                        SelectionChanged="cmbApiFunction_SelectionChanged">
                        <!--  === 標準 MES API ===  -->
                        <ComboBoxItem Content="遠程資訊下發指令" Tag="SEND_MESSAGE_COMMAND" />
                        <ComboBoxItem Content="派針工單建立指令" Tag="CREATE_NEEDLE_WORKORDER_COMMAND" />
                        <ComboBoxItem Content="設備時間同步指令" Tag="DATE_MESSAGE_COMMAND" />
                        <ComboBoxItem Content="刀具工鑽袋檔發送指令" Tag="SWITCH_RECIPE_COMMAND" />
                        <ComboBoxItem Content="設備啟停控制指令" Tag="DEVICE_CONTROL_COMMAND" />
                        <ComboBoxItem Content="倉庫資源查詢指令" Tag="WAREHOUSE_RESOURCE_QUERY_COMMAND" />
                        <ComboBoxItem Content="鑽針履歷查詢指令" Tag="TOOL_TRACE_HISTORY_QUERY_COMMAND" />
                        <!--  === 回報類 API ===  -->
                        <ComboBoxItem Content="配針回報上傳" Tag="TOOL_OUTPUT_REPORT_MESSAGE" />
                        <ComboBoxItem Content="錯誤回報上傳" Tag="ERROR_REPORT_MESSAGE" />
                        <ComboBoxItem Content="機臺狀態上報" Tag="MACHINE_STATUS_REPORT_MESSAGE" />
                        <!--  === 客製化倉庫管理 API ===  -->
                        <ComboBoxItem Content="入庫指令" Tag="IN_MATERIAL_COMMAND" />
                        <ComboBoxItem Content="出庫指令" Tag="OUT_MATERIAL_COMMAND" />
                        <ComboBoxItem Content="依倉儲查詢位置" Tag="GET_LOCATION_BY_STORAGE_COMMAND" />
                        <ComboBoxItem Content="依PIN碼查詢位置" Tag="GET_LOCATION_BY_PIN_COMMAND" />
                        <ComboBoxItem Content="夾具操作指令" Tag="OPERATION_CLAMP_COMMAND" />
                        <ComboBoxItem Content="變更速度指令" Tag="CHANGE_SPEED_COMMAND" />
                        <!--  === 系統管理 API ===  -->
                        <ComboBoxItem Content="伺服器狀態查詢" Tag="SERVER_STATUS_QUERY" />
                        <ComboBoxItem Content="伺服器重啟指令" Tag="SERVER_RESTART_COMMAND" />
                        <ComboBoxItem Content="連線測試指令" Tag="CONNECTION_TEST_COMMAND" />
                    </ComboBox>
                    <Button
                        x:Name="btnSendRequest"
                        Width="80"
                        Margin="10,0"
                        Click="btnSendRequest_Click"
                        Content="發送請求" />
                    <Button
                        x:Name="btnConfigData"
                        Width="80"
                        Margin="0,0,10,0"
                        Click="btnConfigData_Click"
                        Content="設定資料" />
                    <Button
                        x:Name="btnStartHeartbeat"
                        Width="80"
                        Margin="0,0,10,0"
                        Click="btnStartHeartbeat_Click"
                        Content="開始心跳" />
                    <Button
                        x:Name="btnStopHeartbeat"
                        Width="80"
                        Click="btnStopHeartbeat_Click"
                        Content="停止心跳"
                        IsEnabled="False" />
                </StackPanel>
            </Grid>
        </GroupBox>
        <!--  連接資訊與活動監控區  -->
        <TabControl Grid.Row="3" Margin="0,0,0,10">
            <TabItem Header="用戶端連接">                
                <DataGrid
                    x:Name="dgClients"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    SelectionChanged="dgClients_SelectionChanged">
                    <DataGrid.Columns>
                        <DataGridTextColumn
                            Width="200"
                            Binding="{Binding Id}"
                            Header="ID" />
                        <DataGridTextColumn
                            Width="150"
                            Binding="{Binding IpAddress}"
                            Header="IP 位址" />
                        <DataGridTextColumn
                            Width="150"
                            Binding="{Binding ConnectTime}"
                            Header="連接時間" />
                        <DataGridTextColumn
                            Width="150"
                            Binding="{Binding LastActivityTime}"
                            Header="最後活動時間" />
                        <DataGridTextColumn
                            Width="150"
                            Binding="{Binding RequestType}"
                            Header="請求類型" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
            <TabItem Header="伺服端記錄">
                <TextBox
                    x:Name="txtServerMessages"
                    FontFamily="Consolas"
                    HorizontalScrollBarVisibility="Auto"
                    IsReadOnly="True"
                    TextWrapping="Wrap"
                    VerticalScrollBarVisibility="Auto" />
            </TabItem>
            <TabItem Header="用戶端記錄">
                <TextBox
                    x:Name="txtClientMessages"
                    FontFamily="Consolas"
                    HorizontalScrollBarVisibility="Auto"
                    IsReadOnly="True"
                    TextWrapping="Wrap"
                    VerticalScrollBarVisibility="Auto" />
            </TabItem>
            <TabItem Header="API 請求資料範本">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel
                        Grid.Row="0"
                        Margin="0,5"
                        Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            Text="選擇範本:" />                        
                        <ComboBox
                            x:Name="cmbTemplates"
                            Width="320"
                            SelectionChanged="cmbTemplates_SelectionChanged">
                            <!--  伺服端角色 API（接收 MES/IoT 指令）  -->
                            <ComboBoxItem Content="遠程資訊下發指令 (SEND_MESSAGE_COMMAND)" />
                            <ComboBoxItem Content="派針工單建立指令 (CREATE_NEEDLE_WORKORDER_COMMAND)" />
                            <ComboBoxItem Content="設備時間同步指令 (DATE_MESSAGE_COMMAND)" />
                            <ComboBoxItem Content="刀具工鑽袋檔發送指令 (SWITCH_RECIPE_COMMAND)" />
                            <ComboBoxItem Content="設備啟停控制指令 (DEVICE_CONTROL_COMMAND)" />
                            <ComboBoxItem Content="倉庫資源查詢指令 (WAREHOUSE_RESOURCE_QUERY_COMMAND)" />
                            <ComboBoxItem Content="鑽針履歷查詢指令 (TOOL_TRACE_HISTORY_QUERY_COMMAND)" />
                            <!--  用戶端角色 API（主動上報至 MES/IoT）  -->
                            <ComboBoxItem Content="配針回報上傳 (TOOL_OUTPUT_REPORT_MESSAGE)" />
                            <ComboBoxItem Content="錯誤回報上傳 (ERROR_REPORT_MESSAGE)" />
                            <ComboBoxItem Content="機臺狀態上報 (MACHINE_STATUS_REPORT_MESSAGE)" />
                        </ComboBox>
                        <Button
                            x:Name="btnApplyTemplate"
                            Margin="10,0"
                            Click="btnApplyTemplate_Click"
                            Content="套用範本" />
                        <Button
                            x:Name="btnSaveTemplate"
                            Margin="0,0"
                            Click="btnSaveTemplate_Click"
                            Content="儲存為範本" />
                    </StackPanel>
                    <TextBox
                        x:Name="txtTemplate"
                        Grid.Row="1"
                        AcceptsReturn="True"
                        FontFamily="Consolas"
                        HorizontalScrollBarVisibility="Auto"
                        VerticalScrollBarVisibility="Auto" />
                </Grid>
            </TabItem>
        </TabControl>

        <!--  狀態列  -->
        <StatusBar Grid.Row="4" Margin="0,0,0,0">
            <StatusBarItem>
                <TextBlock x:Name="txtStatus" Text="準備就緒" />
            </StatusBarItem>
            <Separator />
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Margin="0,0,5,0" Text="伺服端:" />
                    <Rectangle
                        x:Name="rectServerStatus"
                        Width="15"
                        Height="15"
                        Fill="Gray"
                        Stroke="Black"
                        StrokeThickness="1" />
                </StackPanel>
            </StatusBarItem>
            <Separator />            
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Margin="0,0,5,0" Text="用戶端:" />
                    <Rectangle
                        x:Name="rectClientStatus"
                        Width="15"
                        Height="15"
                        Fill="Gray"
                        Stroke="Black"
                        StrokeThickness="1" />
                </StackPanel>
            </StatusBarItem>
            <Separator />
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Margin="0,0,5,0" Text="IoT 連接:" />
                    <Rectangle
                        x:Name="rectIoTConnectionStatus"
                        Width="15"
                        Height="15"
                        Fill="Gray"
                        Stroke="Black"
                        StrokeThickness="1" />
                </StackPanel>
            </StatusBarItem>
            <Separator />
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Margin="0,0,5,0" Text="心跳狀態:" />
                    <Rectangle
                        x:Name="rectHeartbeatStatus"
                        Width="15"
                        Height="15"
                        Fill="Gray"
                        Stroke="Black"
                        StrokeThickness="1" />
                </StackPanel>
            </StatusBarItem>
            <Separator />
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="txtDateTime" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
