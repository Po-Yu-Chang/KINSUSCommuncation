<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>庫存查詢</title>

    <!-- Bootstrap -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome -->
    <link href="assets/css/fontawesome.min.css" rel="stylesheet" />
    <link href="assets/css/solid.min.css" rel="stylesheet" />
    <link href="assets/css/my.css" rel="stylesheet" />

</head>
<body>

    <!-- 導覽列 ↓ -->
    <nav class="navbar bg-dark navbar-expand-lg bg-body-tertiary" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/"><h1><b>配針機倉庫管理畫面</b></h1></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link active" href="/WareHouseOperations.html">倉儲操作</a>
                </div>
            </div>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link active" href="/inventory.html">鑽針庫存查詢</a>
                </div>
            </div>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link active" href="/storage.html">儲位庫存查詢</a>
                </div>
            </div>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link active" href="/RobotControl.html">機械手臂控制</a>
                </div>
            </div>
        </div>
    </nav>
    <!-- 導覽列 ↑ -->

    <h1></h1>

    <div id="app" class="container align-items-center">
        <nav class="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">首頁</a></li>
                <li class="breadcrumb-item active" aria-current="page">鑽針庫存查詢</li>
            </ol>
        </nav>

        <!-- 內容 ↓ -->
        <div class="alert alert-primary" role="alert">
            <form>
                <div class="row mb-3">
                    <label class="col-sm-3 col-form-label">Flute Diameter</label>
                    <div class="col-sm-9">
                        <input v-model="FluteDiameter" type="number" class="form-control" placeholder="Flute Diameter" min="0" step="0.005">
                    </div>
                </div>
                <div class="row mb-3">
                    <label class="col-sm-3 col-form-label">Flute Length</label>
                    <div class="col-sm-9">
                        <input v-model="FluteLength" type="number" class="form-control" placeholder="Flute Length" min="0">
                    </div>
                </div>
                <div class="row mb-3">
                    <label class="col-sm-3 col-form-label">Coating</label>
                    <div class="col-sm-9">
                        <select v-model="Coating" class="form-control">
                            <option value="">請選擇</option>
                            <option value="Y">Y</option>
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <label class="col-sm-3 col-form-label">Vendor Code</label>
                    <div class="col-sm-9">
                        <select v-model="VendorCode" class="form-control">
                            <option value="">請選擇</option>
                            <option value="CINPHOWN">CINPHOWN</option>
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <label class="col-sm-3 col-form-label">Resharp</label>
                    <div class="col-sm-9">
                        <input v-model="ResharpCount" type="number" class="form-control" placeholder="Resharp" min="0">
                    </div>
                </div>
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" type="button" @click="GetData">Search</button>
                </div>
            </form>

        </div>


        <div id="table-container">
            <table class="table table-bordered align-middle text-center" v-if="StorageInfo.length > 0">
                <thead>
                    <tr class="table-warning">
                        <th>序</th>
                        <th>倉儲位置</th>
                        <th>剩餘盒數</th>
                        <th>剩餘數量</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(s, i) in StorageInfo">
                        <td>{{ i+1 }}</td>
                        <td>
                            <h6>
                                <span :class="s.Area === 'A' ? 'badge text-bg-primary' : 'badge text-bg-success'"> {{ s.Area }} 倉 </span>
                                <i class="fa-solid fa-chevron-right" style=" width:50px;"></i>
                                <span class="badge text-bg-secondary"> {{ s.Layer }} 層 </span>
                                <i class="fa-solid fa-chevron-right" style=" width:50px;"></i>
                                <span class="badge text-bg-secondary"> {{ s.Track }} 軌 </span>
                            </h6>
                        </td>
                        <td>{{ s.listBoxInfo.length }} 盒</td>
                        <td>{{ s.listBoxInfo.reduce((sum, box) => sum + parseInt(box.PinQTY, 10), 0)}}</td>
                    </tr>
                </tbody>
                <tfoot class="table-group-divider">
                    <tr>
                        <th colspan="3" class="text-end">總數量</th>
                        <th>{{ formatNumber(PinTotal) }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>

    </div>
    <!-- collapse ↑ -->
    <!-- 內容 ↑ -->
    </div>

    <!-- Bootstrap -->
    <script type="text/javascript" src="assets/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome -->
    <script type="text/javascript" src="assets/js/all.min.js"></script>
    <script type="text/javascript" src="assets/js/solid.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>


    <script>

        const { createApp } = Vue;

        // 建立 Vue 應用
        const app = createApp({
            data() {
                return {
                    StorageInfo: [],
                    PinTotal: 0,

                    VendorCode:'CINPHOWN',
                    Coating:'Y',
                    FluteDiameter:0.11,
                    FluteLength: 38,
                    ResharpCount: 1,
                };
            },
            methods: {
                GetData() {
                    fetch("/api/getLocationByPin", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            VendorCode: this.VendorCode,
                            Coating: this.Coating,
                            FluteDiameter: this.FluteDiameter,
                            FluteLength: this.FluteLength,
                            ResharpCount: this.ResharpCount,
                        })
                    }).then(response => {
                        if (!response.ok) throw new Error("getLocationByStorage請求失敗");
                        return response.json();
                    }).then(data => {

                        //  排序StorageInfor依照StorageNo (小→大)升冪排序
                        this.StorageInfo = data.StorageInfor.sort((a, b) => parseInt(a.StorageNo) - parseInt(b.StorageNo));

                        this.PinTotal = data.PinTotal;

                    }).catch(error => {
                        alert("getLocationByStorage！");
                    });

                },
                formatNumber(value) {
                    return value.toLocaleString(); 
                }
            },
            watch: {
            },
            created() {
            }
        });

        // 掛載到 DOM
        app.mount('#app');
    </script>


</body>
</html>